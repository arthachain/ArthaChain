<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artha Chain Smart Contracts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.3/codemirror.min.css">
    <style>
        body {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .contract-card {
            margin-bottom: 1.5rem;
        }
        .CodeMirror {
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        nav {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        nav a {
            text-decoration: none;
            color: #3498db;
            font-weight: bold;
        }
        nav a.active {
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
        }
        .deployed-contract {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        .contract-address {
            font-family: monospace;
            word-break: break-all;
        }
        .contract-methods {
            margin-top: 10px;
        }
        .method-button {
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .loading-indicator {
            display: none;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="mb-4">
            <h1 class="display-4">Artha Chain Smart Contracts</h1>
            <p class="lead">Deploy and interact with smart contracts on the testnet</p>
            <nav>
                <a href="index.html">Explorer</a>
                <a href="faucet.html">Faucet</a>
                <a href="wallet.html">Wallet</a>
                <a href="contracts.html" class="active">Smart Contracts</a>
            </nav>
        </header>

        <div class="row">
            <div class="col-md-12">
                <!-- Contract Tools Card -->
                <div class="card contract-card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="contract-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" id="deploy-tab" data-bs-toggle="tab" href="#deploy">Deploy Contract</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="interact-tab" data-bs-toggle="tab" href="#interact">Interact</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="examples-tab" data-bs-toggle="tab" href="#examples">Examples</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <!-- Deploy Contract Tab -->
                            <div class="tab-pane fade show active" id="deploy">
                                <div class="mb-3">
                                    <label for="contract-language" class="form-label">Contract Language</label>
                                    <select class="form-select" id="contract-language">
                                        <option value="solidity">Solidity</option>
                                        <option value="rust">Rust (WASM)</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="contract-name" class="form-label">Contract Name</label>
                                    <input type="text" class="form-control" id="contract-name" placeholder="MyContract">
                                </div>
                                <div class="mb-3">
                                    <label for="contract-code" class="form-label">Contract Code</label>
                                    <textarea id="contract-code" class="form-control"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="deployment-fee" class="form-label">Deployment Fee (ARTHA)</label>
                                    <input type="number" class="form-control" id="deployment-fee" value="100" min="10">
                                    <small class="text-muted">Minimum fee is 10 ARTHA</small>
                                </div>
                                <div class="mb-3">
                                    <label for="constructor-args" class="form-label">Constructor Arguments (JSON)</label>
                                    <input type="text" class="form-control" id="constructor-args" placeholder='["arg1", 123]'>
                                    <small class="text-muted">Optional: JSON array of constructor arguments</small>
                                </div>
                                <button class="btn btn-primary" id="deploy-btn">Deploy Contract</button>
                                
                                <div class="loading-indicator" id="deploy-loading">
                                    <div class="d-flex align-items-center">
                                        <div class="spinner-border spinner-border-sm me-2" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <div>Deploying contract... Please wait.</div>
                                    </div>
                                    <div class="progress mt-2">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" id="deploy-progress"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Interact with Contract Tab -->
                            <div class="tab-pane fade" id="interact">
                                <div class="mb-3">
                                    <label for="contract-address" class="form-label">Contract Address</label>
                                    <input type="text" class="form-control" id="contract-address" placeholder="0x...">
                                </div>
                                <div class="mb-3">
                                    <label for="contract-abi" class="form-label">Contract ABI/Interface</label>
                                    <textarea class="form-control" id="contract-abi" rows="5" placeholder='[{"inputs":[],"name":"greet","outputs":[{"name":"","type":"string"}],"stateMutability":"view","type":"function"}]'></textarea>
                                </div>
                                <button class="btn btn-primary" id="load-contract-btn">Load Contract</button>
                                
                                <div class="mt-4" id="contract-interactions" style="display: none;">
                                    <h5>Contract Methods</h5>
                                    <div id="contract-methods"></div>
                                    
                                    <div class="mt-3" id="method-caller" style="display: none;">
                                        <h6 id="selected-method-name">Method Name</h6>
                                        <div id="method-params"></div>
                                        <div class="mb-3">
                                            <label for="tx-value" class="form-label">Send Value (ARTHA)</label>
                                            <input type="number" class="form-control" id="tx-value" value="0" min="0">
                                        </div>
                                        <button class="btn btn-success" id="call-method-btn">Call Method</button>
                                        
                                        <div class="mt-3">
                                            <h6>Result:</h6>
                                            <pre id="method-result" class="p-3 bg-light"></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Examples Tab -->
                            <div class="tab-pane fade" id="examples">
                                <h5>Example Contracts</h5>
                                
                                <div class="mb-4">
                                    <h6>Solidity: Simple Storage</h6>
                                    <button class="btn btn-sm btn-outline-primary mb-2" id="load-storage-example">Load Example</button>
                                    <pre class="bg-light p-3"><code>// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract SimpleStorage {
    uint256 private value;
    
    event ValueChanged(uint256 newValue);
    
    function setValue(uint256 _value) public {
        value = _value;
        emit ValueChanged(_value);
    }
    
    function getValue() public view returns (uint256) {
        return value;
    }
}</code></pre>
                                </div>
                                
                                <div class="mb-4">
                                    <h6>Rust: Counter Contract</h6>
                                    <button class="btn btn-sm btn-outline-primary mb-2" id="load-counter-example">Load Example</button>
                                    <pre class="bg-light p-3"><code>#[contract]
mod counter {
    use contract_sdk::storage;
    
    #[init]
    pub fn init() {
        storage::set_u64("count", 0);
    }
    
    #[call]
    pub fn increment() {
        let current = storage::get_u64("count");
        storage::set_u64("count", current + 1);
    }
    
    #[call]
    pub fn get_count() -> u64 {
        storage::get_u64("count")
    }
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Deployed Contracts -->
                <div class="card">
                    <div class="card-header">Deployed Contracts</div>
                    <div class="card-body">
                        <div id="deployed-contracts">
                            <div class="text-center py-3">No contracts deployed yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.3/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.3/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.3/mode/rust/rust.min.js"></script>
    <script>
        // Initialize CodeMirror editor
        const codeEditor = CodeMirror.fromTextArea(document.getElementById('contract-code'), {
            lineNumbers: true,
            mode: 'text/javascript',
            theme: 'default',
            indentUnit: 4,
            indentWithTabs: false,
            smartIndent: true
        });
        
        // Store deployed contracts in localStorage
        const CONTRACTS_STORAGE_KEY = 'artha_deployed_contracts';
        
        // Get wallet info
        const WALLET_STORAGE_KEY = 'artha_testnet_wallet';
        
        // DOM elements
        const contractLanguage = document.getElementById('contract-language');
        const contractNameInput = document.getElementById('contract-name');
        const deployBtn = document.getElementById('deploy-btn');
        const deployLoading = document.getElementById('deploy-loading');
        const deployProgress = document.getElementById('deploy-progress');
        const loadContractBtn = document.getElementById('load-contract-btn');
        const contractAddress = document.getElementById('contract-address');
        const contractAbi = document.getElementById('contract-abi');
        const contractInteractions = document.getElementById('contract-interactions');
        const contractMethods = document.getElementById('contract-methods');
        const methodCaller = document.getElementById('method-caller');
        const selectedMethodName = document.getElementById('selected-method-name');
        const methodParams = document.getElementById('method-params');
        const txValue = document.getElementById('tx-value');
        const callMethodBtn = document.getElementById('call-method-btn');
        const methodResult = document.getElementById('method-result');
        const loadStorageExample = document.getElementById('load-storage-example');
        const loadCounterExample = document.getElementById('load-counter-example');
        const deployedContractsEl = document.getElementById('deployed-contracts');
        
        // Change code editor mode based on selected language
        contractLanguage.addEventListener('change', () => {
            const language = contractLanguage.value;
            if (language === 'solidity') {
                codeEditor.setOption('mode', 'text/javascript');
            } else if (language === 'rust') {
                codeEditor.setOption('mode', 'text/x-rustsrc');
            }
        });
        
        // Load example contracts
        loadStorageExample.addEventListener('click', () => {
            contractLanguage.value = 'solidity';
            contractLanguage.dispatchEvent(new Event('change'));
            contractNameInput.value = 'SimpleStorage';
            const code = document.querySelector('#examples pre:nth-of-type(1) code').textContent;
            codeEditor.setValue(code);
        });
        
        loadCounterExample.addEventListener('click', () => {
            contractLanguage.value = 'rust';
            contractLanguage.dispatchEvent(new Event('change'));
            contractNameInput.value = 'Counter';
            const code = document.querySelector('#examples pre:nth-of-type(2) code').textContent;
            codeEditor.setValue(code);
        });
        
        // Deploy contract
        deployBtn.addEventListener('click', async () => {
            // Check if wallet exists
            const walletData = JSON.parse(localStorage.getItem(WALLET_STORAGE_KEY) || '{}');
            if (!walletData.address) {
                alert('Please create a wallet first before deploying contracts.');
                return;
            }
            
            const contractCode = codeEditor.getValue();
            const contractName = contractNameInput.value.trim();
            const language = contractLanguage.value;
            const fee = document.getElementById('deployment-fee').value;
            const constructorArgs = document.getElementById('constructor-args').value.trim();
            
            if (!contractName) {
                alert('Please enter a contract name');
                return;
            }
            
            if (!contractCode) {
                alert('Please enter contract code');
                return;
            }
            
            // Show loading indicator
            deployBtn.disabled = true;
            deployLoading.style.display = 'block';
            
            // Simulate deployment process
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                deployProgress.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    finishDeployment();
                }
            }, 300);
            
            function finishDeployment() {
                // Generate contract address and ABI
                const contractAddress = '0x' + Array.from({length: 40}, () => 
                    Math.floor(Math.random() * 16).toString(16)).join('');
                
                let contractAbi;
                
                if (language === 'solidity') {
                    if (contractName === 'SimpleStorage') {
                        contractAbi = [
                            {
                                "inputs": [{"name": "_value","type": "uint256"}],
                                "name": "setValue",
                                "outputs": [],
                                "stateMutability": "nonpayable",
                                "type": "function"
                            },
                            {
                                "inputs": [],
                                "name": "getValue",
                                "outputs": [{"name": "","type": "uint256"}],
                                "stateMutability": "view",
                                "type": "function"
                            },
                            {
                                "anonymous": false,
                                "inputs": [{"indexed": false,"name": "newValue","type": "uint256"}],
                                "name": "ValueChanged",
                                "type": "event"
                            }
                        ];
                    } else {
                        // Generate a generic ABI for other contracts
                        contractAbi = [
                            {
                                "inputs": [],
                                "name": "getData",
                                "outputs": [{"name": "","type": "string"}],
                                "stateMutability": "view",
                                "type": "function"
                            },
                            {
                                "inputs": [{"name": "_data","type": "string"}],
                                "name": "setData",
                                "outputs": [],
                                "stateMutability": "nonpayable",
                                "type": "function"
                            }
                        ];
                    }
                } else {
                    // Rust contract generic ABI
                    contractAbi = [
                        {
                            "inputs": [],
                            "name": "get_count",
                            "outputs": [{"name": "","type": "uint64"}],
                            "stateMutability": "view",
                            "type": "function"
                        },
                        {
                            "inputs": [],
                            "name": "increment",
                            "outputs": [],
                            "stateMutability": "nonpayable",
                            "type": "function"
                        }
                    ];
                }
                
                // Generate transaction hash for deployment
                const txHash = '0x' + Array.from({length: 64}, () => 
                    Math.floor(Math.random() * 16).toString(16)).join('');
                
                // Save deployed contract
                const deployedContracts = JSON.parse(localStorage.getItem(CONTRACTS_STORAGE_KEY) || '[]');
                
                const newContract = {
                    name: contractName,
                    address: contractAddress,
                    language: language,
                    abi: contractAbi,
                    code: contractCode,
                    creator: walletData.address,
                    deployedAt: Date.now(),
                    txHash: txHash
                };
                
                deployedContracts.push(newContract);
                localStorage.setItem(CONTRACTS_STORAGE_KEY, JSON.stringify(deployedContracts));
                
                // Add deployment transaction to recent transactions
                addDeploymentTransaction(newContract, fee);
                
                // Reset UI
                deployBtn.disabled = false;
                deployLoading.style.display = 'none';
                deployProgress.style.width = '0%';
                
                // Show success message
                alert(`Contract ${contractName} deployed successfully at ${contractAddress}`);
                
                // Update deployed contracts list
                displayDeployedContracts();
            }
            
            // Add deployment transaction to the recent transactions list
            function addDeploymentTransaction(contract, fee) {
                try {
                    // Get existing transactions
                    const recentTxs = JSON.parse(localStorage.getItem('recent_transactions') || '[]');
                    
                    // Create a new transaction for contract deployment
                    const deploymentTx = {
                        hash: contract.txHash,
                        sender: contract.creator,
                        recipient: contract.address,
                        amount: parseInt(fee) || 100,
                        status: 'confirmed',
                        block_height: Math.floor(Math.random() * 10) + 4,
                        timestamp: Date.now(),
                        type: 'contract_deployment',
                        contract_name: contract.name,
                        contract_language: contract.language
                    };
                    
                    console.log('Adding contract deployment transaction:', deploymentTx);
                    
                    // Add to beginning of array
                    recentTxs.unshift(deploymentTx);
                    
                    // Keep only the most recent transactions
                    const updatedTxs = recentTxs.slice(0, 20);
                    
                    // Save back to localStorage
                    localStorage.setItem('recent_transactions', JSON.stringify(updatedTxs));
                } catch (error) {
                    console.error('Error adding deployment transaction:', error);
                }
            }
        });
        
        // Load contract for interaction
        loadContractBtn.addEventListener('click', () => {
            const address = contractAddress.value.trim();
            let abi = contractAbi.value.trim();
            
            if (!address) {
                alert('Please enter a contract address');
                return;
            }
            
            // Try to find contract in deployed contracts
            const deployedContracts = JSON.parse(localStorage.getItem(CONTRACTS_STORAGE_KEY) || '[]');
            const contract = deployedContracts.find(c => c.address === address);
            
            if (contract) {
                // Found deployed contract, use its ABI
                abi = JSON.stringify(contract.abi);
                contractAbi.value = abi;
            } else if (!abi) {
                alert('Contract not found. Please provide ABI.');
                return;
            }
            
            try {
                const abiObj = JSON.parse(abi);
                displayContractMethods(abiObj);
                contractInteractions.style.display = 'block';
            } catch (error) {
                alert('Invalid ABI format. Please check your input.');
                console.error(error);
            }
        });
        
        // Display contract methods
        function displayContractMethods(abi) {
            contractMethods.innerHTML = '';
            
            abi.forEach(item => {
                if (item.type === 'function') {
                    const btn = document.createElement('button');
                    btn.className = 'btn btn-sm btn-outline-secondary method-button';
                    
                    // Format method name with parameters
                    let buttonText = item.name + '(';
                    if (item.inputs && item.inputs.length > 0) {
                        buttonText += item.inputs.map(input => `${input.type} ${input.name}`).join(', ');
                    }
                    buttonText += ')';
                    
                    // Add return type if applicable
                    if (item.outputs && item.outputs.length > 0) {
                        buttonText += ' → ';
                        buttonText += item.outputs.map(output => output.type).join(', ');
                    }
                    
                    btn.textContent = buttonText;
                    btn.dataset.method = JSON.stringify(item);
                    
                    // Add color based on mutability
                    if (item.stateMutability === 'view' || item.stateMutability === 'pure') {
                        btn.classList.replace('btn-outline-secondary', 'btn-outline-primary');
                    } else {
                        btn.classList.replace('btn-outline-secondary', 'btn-outline-warning');
                    }
                    
                    btn.addEventListener('click', () => selectMethod(item));
                    contractMethods.appendChild(btn);
                }
            });
        }
        
        // Select a method for interaction
        function selectMethod(method) {
            selectedMethodName.textContent = method.name;
            methodParams.innerHTML = '';
            
            // Show transaction value input only for payable methods
            txValue.parentElement.style.display = method.stateMutability === 'payable' ? 'block' : 'none';
            
            // Create input fields for parameters
            if (method.inputs && method.inputs.length > 0) {
                method.inputs.forEach((input, index) => {
                    const div = document.createElement('div');
                    div.className = 'mb-3';
                    
                    const label = document.createElement('label');
                    label.className = 'form-label';
                    label.textContent = `${input.name} (${input.type})`;
                    
                    const inputEl = document.createElement('input');
                    inputEl.className = 'form-control';
                    inputEl.id = `param-${index}`;
                    inputEl.dataset.type = input.type;
                    
                    div.appendChild(label);
                    div.appendChild(inputEl);
                    methodParams.appendChild(div);
                });
            } else {
                methodParams.innerHTML = '<p>No parameters required</p>';
            }
            
            // Store current method for later use
            callMethodBtn.dataset.method = JSON.stringify(method);
            
            methodCaller.style.display = 'block';
            methodResult.textContent = '';
        }
        
        // Call contract method
        callMethodBtn.addEventListener('click', () => {
            const method = JSON.parse(callMethodBtn.dataset.method);
            const params = [];
            
            // Get wallet data
            const walletData = JSON.parse(localStorage.getItem(WALLET_STORAGE_KEY) || '{}');
            if (!walletData.address && !method.stateMutability === 'view') {
                alert('Please create a wallet first to send transactions.');
                return;
            }
            
            // Collect parameter values
            if (method.inputs && method.inputs.length > 0) {
                for (let i = 0; i < method.inputs.length; i++) {
                    const value = document.getElementById(`param-${i}`).value;
                    params.push(value);
                }
            }
            
            // Get transaction value
            const value = parseInt(txValue.value) || 0;
            
            // Get contract address
            const contractAddr = contractAddress.value.trim();
            
            // Simulate contract call
            callMethodBtn.disabled = true;
            setTimeout(() => {
                let result;
                
                if (method.name === 'getValue' || method.name === 'get_count') {
                    // Simulate a stored value for demo
                    result = Math.floor(Math.random() * 100);
                } else if (method.name === 'getData') {
                    result = "Sample data from contract";
                } else if (method.stateMutability === 'view' || method.stateMutability === 'pure') {
                    // Generic result for view functions
                    if (method.outputs && method.outputs.length > 0) {
                        if (method.outputs[0].type.includes('int')) {
                            result = Math.floor(Math.random() * 1000);
                        } else if (method.outputs[0].type === 'string') {
                            result = "Example result string";
                        } else if (method.outputs[0].type === 'bool') {
                            result = Math.random() > 0.5;
                        } else {
                            result = "0x" + Math.random().toString(16).substring(2);
                        }
                    }
                } else {
                    // Transaction result
                    const txHash = '0x' + Array.from({length: 64}, () => 
                        Math.floor(Math.random() * 16).toString(16)).join('');
                    
                    const blockNumber = Math.floor(Math.random() * 100) + 1;
                    const gasUsed = Math.floor(Math.random() * 1000000) + 21000;
                    
                    result = {
                        success: true,
                        txHash: txHash,
                        blockNumber: blockNumber,
                        gasUsed: gasUsed
                    };
                    
                    // Add method call to transactions
                    if (method.stateMutability !== 'view' && method.stateMutability !== 'pure') {
                        addMethodCallTransaction(method, params, contractAddr, walletData.address, value, txHash, blockNumber);
                    }
                }
                
                methodResult.textContent = JSON.stringify(result, null, 2);
                callMethodBtn.disabled = false;
            }, 1500);
        });
        
        // Add method call transaction to recent transactions
        function addMethodCallTransaction(method, params, contractAddress, sender, value, txHash, blockNumber) {
            try {
                // Get existing transactions
                const recentTxs = JSON.parse(localStorage.getItem('recent_transactions') || '[]');
                
                // Format parameters for display
                let paramsFormatted = '';
                if (params.length > 0) {
                    paramsFormatted = params.map(p => JSON.stringify(p)).join(', ');
                }
                
                // Create a new transaction for the method call
                const methodCallTx = {
                    hash: txHash,
                    sender: sender,
                    recipient: contractAddress,
                    amount: value,
                    status: 'confirmed',
                    block_height: blockNumber,
                    timestamp: Date.now(),
                    type: 'contract_call',
                    method_name: method.name,
                    method_params: paramsFormatted,
                    method_type: method.stateMutability
                };
                
                console.log('Adding contract method call transaction:', methodCallTx);
                
                // Add to beginning of array
                recentTxs.unshift(methodCallTx);
                
                // Keep only the most recent transactions
                const updatedTxs = recentTxs.slice(0, 20);
                
                // Save back to localStorage
                localStorage.setItem('recent_transactions', JSON.stringify(updatedTxs));
            } catch (error) {
                console.error('Error adding method call transaction:', error);
            }
        }
        
        // Display deployed contracts
        function displayDeployedContracts() {
            const deployedContracts = JSON.parse(localStorage.getItem(CONTRACTS_STORAGE_KEY) || '[]');
            
            if (deployedContracts.length === 0) {
                deployedContractsEl.innerHTML = '<div class="text-center py-3">No contracts deployed yet</div>';
                return;
            }
            
            deployedContractsEl.innerHTML = '';
            
            deployedContracts.forEach(contract => {
                const contractEl = document.createElement('div');
                contractEl.className = 'deployed-contract';
                
                const deploytime = new Date(contract.deployedAt).toLocaleString();
                
                contractEl.innerHTML = `
                    <h5>${contract.name}</h5>
                    <div><strong>Address:</strong> <span class="contract-address">${contract.address}</span></div>
                    <div><strong>Language:</strong> ${contract.language}</div>
                    <div><strong>Deployed:</strong> ${deploytime}</div>
                    <div><strong>Creator:</strong> ${contract.creator}</div>
                    <div class="contract-methods mt-3">
                        <button class="btn btn-sm btn-primary load-contract-btn" data-address="${contract.address}">Load in Interface</button>
                        <button class="btn btn-sm btn-outline-secondary view-code-btn" data-address="${contract.address}">View Code</button>
                    </div>
                `;
                
                deployedContractsEl.appendChild(contractEl);
                
                // Add event listener for the "Load in Interface" button
                contractEl.querySelector('.load-contract-btn').addEventListener('click', () => {
                    contractAddress.value = contract.address;
                    contractAbi.value = JSON.stringify(contract.abi, null, 2);
                    
                    // Switch to interact tab
                    document.getElementById('interact-tab').click();
                    
                    // Load the contract
                    loadContractBtn.click();
                });
                
                // Add event listener for the "View Code" button
                contractEl.querySelector('.view-code-btn').addEventListener('click', () => {
                    alert(`Contract Code for ${contract.name}:\n\n${contract.code}`);
                });
            });
        }
        
        // Initialize tabs
        const tabElements = document.querySelectorAll('#contract-tabs [data-bs-toggle="tab"]');
        tabElements.forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                tabElements.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const targetId = tab.getAttribute('href').substring(1);
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('show', 'active');
                });
                document.getElementById(targetId).classList.add('show', 'active');
            });
        });
        
        // Check if wallet exists
        function checkWalletExists() {
            const walletData = JSON.parse(localStorage.getItem(WALLET_STORAGE_KEY) || '{}');
            if (!walletData.address) {
                alert('Please create a wallet first to deploy and interact with contracts.');
            }
        }
        
        // Initialize page
        window.addEventListener('load', () => {
            displayDeployedContracts();
            checkWalletExists();
            
            // Example ABI for the contract interaction tab
            contractAbi.value = JSON.stringify([
                {
                    "inputs": [],
                    "name": "getValue",
                    "outputs": [{"name": "","type": "uint256"}],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [{"name": "_value","type": "uint256"}],
                    "name": "setValue",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                }
            ], null, 2);
        });
    </script>
</body>
</html> 